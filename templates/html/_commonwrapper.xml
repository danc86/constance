<?xml version="1.0" encoding="UTF-8" ?>
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:py="http://genshi.edgewall.org/"
     xmlns:xi="http://www.w3.org/2001/XInclude"
     py:strip="True">

<xi:include href="_fragments.xml" />

<?python
import yaml
?>

<py:match path="head">
	<head profile="http://gmpg.org/xfn/11" py:attrs="select('@*')" py:with="title = unicode(select('title[1]/text()'))">
		${select('./*[local-name() != "title"]')}
        <title py:if="title">${title} - ${config.getunicode('global', 'name')}</title>
		<title py:if="not title">${config.getunicode('global', 'name')}</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="generator" content="constance" />
        <link rel="stylesheet" type="text/css" href="/static/css/common.css" /><!-- XXX script_name -->
	</head>
</py:match>

<py:match path="body">
	<body py:attrs="select('@*')">
        <div id="contentwrapper">
            <div id="content">
                ${select('./*')}
            </div>
        </div>
        <div id="links" 
             py:if="config.getunicode('links', 'filename')"
             py:with="link_sections = yaml.load(open(config.getunicode('links', 'filename'), 'r'))">
            <div class="linkrow" py:for="section, links in link_sections.iteritems()">
                <h2>${section}</h2>
                <p>
                    <py:for each="n, link in enumerate(links)">
                        <py:if test="n &gt; 0">${inline_sep()}</py:if>
                        <a py:attrs="dict((a, v) for a, v in link.iteritems() if a != 'anchor')">${link['anchor']}</a>
                    </py:for>
                </p>
            </div>
        </div>
	</body>
</py:match>

</div>

