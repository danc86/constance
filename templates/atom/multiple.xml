<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:py="http://genshi.edgewall.org/"
	  xmlns:xi="http://www.w3.org/2001/XInclude">

<?python
from viewutils import ATOM_TIME_FORMAT
sorted_items = sorted(items, key=lambda item: item.publication_date, reverse=True)[:config.getint('global', 'items_in_feed')]
?>

<id>${self_url}</id>
<title type="text">${config.getunicode('global', 'name')}<py:if test="title"> (${title})</py:if></title>
<link rel="self" type="application/atom+xml" href="${self_url}" />
<link rel="alternate" href="${self_url}" />
<generator>constance</generator>
<updated py:if="sorted_items">${max(item.modified_date for item in sorted_items).strftime(ATOM_TIME_FORMAT)}</updated>

<py:for each="item in sorted_items">
    ${item.render('application/atom+xml')}
</py:for>

</feed>
