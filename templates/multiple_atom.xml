<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:xhtml="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
	  xmlns:xi="http://www.w3.org/2001/XInclude">

<?python
import blog
from viewutils import tag_list
ATOM_TIME_FORMAT = str('%Y-%m-%dT%H:%M:%S+10:00')
?>

<id>${self_url}?format=atom</id>
<title type="text">${config.getunicode('global', 'name')}<py:if test="title"> (${title})</py:if></title>
<link rel="self" type="application/atom+xml" href="${self_url}?format=atom" />
<link rel="alternate" href="${self_url}" />
<generator>constance</generator>
<updated>${feed_updated.strftime(ATOM_TIME_FORMAT)}</updated>

<entry py:for="entry in sorted_entries">
	<id>${entry.guid}</id>
	<published>${entry.publication_date.strftime(ATOM_TIME_FORMAT)}</published>
	<updated>${entry.modified_date.strftime(ATOM_TIME_FORMAT)}</updated>
	<author py:with="email = config.getunicode('global', 'email')">
		<name>${config.getunicode('global', 'author')}</name>
		<email py:if="email">${email}</email>
	</author>
	<category py:for="tag in entry.tags" scheme="${environ['APP_URI']}/+tags/" term="${tag}" />
	<py:if test="isinstance(entry, blog.BlogEntry)">
		<link rel="alternate" href="${environ['APP_URI']}/${entry.id}" />
		<title type="text">${entry.title}</title>
		<content type="xhtml" xml:base="${environ['APP_URI']}/${entry.id}"><xhtml:div>
			<p py:if="entry.tags">Tagged: ${tag_list(environ.get('SCRIPT_NAME', ''), entry.tags)}</p>
			${entry.body}
		</xhtml:div></content>
	</py:if>
	<py:if test="isinstance(entry, blog.ReadingLogEntry)">
		<title type="text">${entry.title} by ${entry.author}</title>
		<summary py:if="entry.rating" type="text">${entry.rating} stars</summary>
		<content type="xhtml"><xhtml:div>
			<p><a href="${entry.url}">${entry.title}</a> by ${entry.author}</p>
			<p py:if="entry.rating">${entry.rating} stars</p>
		</xhtml:div></content>
	</py:if>
</entry>

</feed>
