<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:py="http://genshi.edgewall.org/"
	  xmlns:xi="http://www.w3.org/2001/XInclude">

<xi:include href="_fragments.xml" />

<?python
import blog
from viewutils import markdown, tag_list
ATOM_TIME_FORMAT = str('%Y-%m-%dT%H:%M:%S+10:00')
?>

<id>${self_url}?format=atom</id>
<title type="text">${config.getunicode('global', 'name')}<py:if test="title"> (${title})</py:if></title>
<link rel="self" type="application/atom+xml" href="${self_url}?format=atom" />
<link rel="alternate" href="${self_url}" />
<generator>constance</generator>
<updated>${feed_updated.strftime(ATOM_TIME_FORMAT)}</updated>

<entry py:for="entry in sorted_entries">
	<id>${entry.guid}</id>
	<published>${entry.publication_date.strftime(ATOM_TIME_FORMAT)}</published>
	<updated>${entry.modified_date.strftime(ATOM_TIME_FORMAT)}</updated>
	<author py:with="email = config.getunicode('global', 'email')">
		<name>${config.getunicode('global', 'author')}</name>
		<email py:if="email">${email}</email>
	</author>
	<category py:for="tag in entry.tags" scheme="${abs_uri('tags', '')}" term="${tag}" />
	<py:if test="isinstance(entry, blog.BlogEntry)">
		<link rel="alternate" href="${abs_uri('blog', entry.id)}" />
		<title type="text">${entry.title}</title>
		<content type="xhtml" xml:base="${abs_uri('blog', entry.id)}">
            <div xmlns="http://www.w3.org/1999/xhtml">
                <p py:if="entry.tags">Tagged: ${tag_list(environ.get('SCRIPT_NAME', ''), entry.tags)}</p>
                ${markdown(entry.body)}
            </div>
		</content>
	</py:if>
	<py:if test="isinstance(entry, blog.ReadingLogEntry)">
		<link rel="alternate" href="${abs_uri('reading', '')}#entry-${entry.id}" />
		<title type="text">${entry.title} by ${entry.author}</title>
		<summary py:if="entry.rating" type="text">${entry.rating} stars</summary>
		<content type="xhtml">
            <div xmlns="http://www.w3.org/1999/xhtml">
                <p><a href="${entry.url}">${entry.title}</a> by ${entry.author}</p>
                <p py:if="entry.rating">${entry.rating} stars</p>
            </div>
        </content>
	</py:if>
</entry>

</feed>
