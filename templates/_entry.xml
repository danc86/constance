<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:py="http://genshi.edgewall.org/"
	 py:strip="True"
	 py:def="show_entry(entry, show_comments=True)">

<?python
import blog
from viewutils import mini_markdown, tag_list
?>

<div class="entry" py:if="isinstance(entry, blog.Entry)">

	<h3 class="entrytitle" id="post-${entry.id}">${mini_markdown(entry.title)}</h3>

	<div class="entrydate">
		${entry.publication_date.strftime(str('%-1d %b %Y'))}
	    <a href="${environ.get('SCRIPT_NAME', '')}/${entry.id}" rel="bookmark" class="permalink" title="permalink">#</a>
	</div>

    <div py:if="entry.tags" class="entrytags">
        tagged: ${tag_list(environ.get('SCRIPT_NAME', ''), entry.tags)}
    </div>
  
	<div class="entrybody">
		${entry.body}
    </div>

    <div class="entrycommentslink" py:if="not show_comments and entry.has_comments()">
        <a href="${environ.get('SCRIPT_NAME', '')}/${entry.id}#comments" py:choose="len(entry.comments())">
            <py:when test="0">no comments »</py:when>
            <py:when test="1">1 comment »</py:when>
            <py:otherwise>${len(entry.comments())} comments »</py:otherwise>
        </a>
    </div>

    <div class="commentblock" py:if="show_comments and entry.has_comments()"
         py:with="comments = sorted(entry.comments(), key=lambda c: c.date)">
        <h4 class="comments" py:choose="len(comments)">
            <py:when test="0">No comments</py:when>
            <py:when test="1">1 comment</py:when>
            <py:otherwise>${len(entry.comments())} comments</py:otherwise>
        </h4>
        <div py:for="n, comment in enumerate(comments)" id="comment-${comment.id}">
            <py:if test="n > 0">${block_sep()}</py:if>
            ${comment.body}
            <p class="commentmeta">
                ― <a py:strip="not comment.author_url" href="${comment.author_url}">${comment.author_name()}</a>
                <span class="commentdatetime">${comment.date.strftime(str('%-1d %b %Y %H:%M'))}</span>
                <a href="#comment-${comment.id}" class="permalink" title="permalink">#</a>
            </p>
        </div>
    </div>

</div>

<span py:def="stars(rating)" py:strip="True">
<img src="${environ.get('SCRIPT_NAME', '')}/static/images/star.png" alt="[star]" py:for="_ in range(int(rating))" /><img src="${environ.get('SCRIPT_NAME', '')}/static/images/star-half.png" alt="[half-star]" py:if="rating > int(rating)" /><img src="${environ.get('SCRIPT_NAME', '')}/static/images/star-off.png" alt="" py:for="_ in range(int(5 - rating))" />
</span>

<div class="entry readinglog" py:if="isinstance(entry, blog.ReadingLogEntry)">

    <img py:if="config.getboolean('readinglog', 'show_covers') and entry.isbn" class="cover"
         src="http://covers.librarything.com/devkey/${config.get('readinglog', 'librarything_devkey')}/small/isbn/${entry.isbn}" 
         alt="Cover image for ${entry.title}" />

    <h3 class="entrytitle" id="post-${entry.id}">
        <a py:strip="not entry.url" href="${entry.url}">${mini_markdown(entry.title)}</a>
        <py:if test="entry.author">
            <span class="author">by ${entry.author}</span>
        </py:if>
    </h3>

    <div class="entrydate">
        ${entry.publication_date.strftime(str('%-1d %b %Y'))}
    </div>

    <div py:if="entry.rating" class="rating">
        ${stars(entry.rating)}
    </div>

</div>

</div>
